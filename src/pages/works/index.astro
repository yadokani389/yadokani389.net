---
import { getCollection } from "astro:content";
import TagFilterScript from "../../components/TagFilterScript.astro";
import TagList from "../../components/TagList.svelte";
import Layout from "../../layouts/Layout.astro";

const works = (await getCollection("works")).sort((a, b) =>
  a.data.title.localeCompare(b.data.title),
);
---

<Layout title="Works" description="制作したゲームやツールの一覧">
  <div class="container">
    <h1 class="page-title">Works</h1>

    <div class="filter-banner" data-filter-banner>
      <div class="filter-info">
        <span>タグ:</span>
        <strong data-filter-label></strong>
      </div>
      <a class="filter-clear" href="/works">解除</a>
    </div>

    <div class="list-stack">
      {
        works.map((work) => (
          <article
            class="card"
            data-card-link
            data-href={`/works/${work.id}`}
            data-tags={work.data.tags?.join(",") ?? ""}
            role="link"
            tabindex="0"
            aria-label={`${work.data.title} の詳細へ移動`}
          >
            {work.data.thumbnail && (
              <img
                class="card-thumb"
                src={work.data.thumbnail}
                alt={`${work.data.title} のサムネイル`}
                loading="lazy"
              />
            )}
            <div>
              <h2 class="card-title">{work.data.title}</h2>
              <p class="card-description">{work.data.description}</p>
            </div>
            <TagList tags={work.data.tags ?? []} basePath="/works" />
          </article>
        ))
      }
    </div>
  </div>

  <TagFilterScript />
</Layout>
